---
layout: post
title: 카카오 알림톡 API 개발
date: 2019-11-15 17:00:00 +0900
category: 서버
tags: 카카오톡, 알림톡, API
---


# 카카오 알람톡이란?
인터넷 쇼핑몰에서 물건을 구매했을때, 혹은 배송이 시작되었을때  
카카오톡으로 평소와 다른 톡이 날라오곤 합니다.  
이게 바로 알람톡!

![언제나설레이는배송시작알람](https://user-images.githubusercontent.com/7343388/68920839-e9bc5700-07b9-11ea-8ba0-cf080b841011.jpg)

문자 대신 카카오로 보내주니까 익숙하고 편한것 같아요.  
보통 배송조회 와 같은 정보를 확인할 수 있는 링크까지 딸려오니까 더 좋죠.  

이러한 알람톡을 내 서비스에도 쓸 수 있다면 좋겠죠?  

# 준비 사항
아래와 두가지가 필요합니다.  
- 플러스친구  
- 사업자등록번호  
보내는 사람이 플러스친구 명의로 나가기 때문에 이걸 만들어야 하고  
(만드는 것은 여기에서 : [https://center-pf.kakao.com/](https://center-pf.kakao.com/ "플러스친구"))  
그리고 등록된 사업자만 가능합니다.  
플러스친구를 만들고 나면 비즈니스인증 메뉴에서 사업자번호, 사업자등록증을 이용해  
인증을 완료해야 쓸 수 있다는 점.   


# 알리고
알림톡API는 카카오 에서 직접 제공하지 않기 때문에 중간 도매업체를 통해 진행해야 합니다.  
여러 회사들을 검색을 통해 알리고([https://smartsms.aligo.in/aligoxkakao.html](https://smartsms.aligo.in/aligoxkakao.html "알리고"))란 회사가 
가장 싼 것을 확인 했습니다.(2019년 기준)  
건당 6.5원!!  

![알리고 가격](https://smartsms.aligo.in/img/shop/img-why-01.png)

알리고는 fail over도 지원합니다!  
fail over란 개발에서 보통 서버 2개 이상을 분산해서 쓰고 있을때  
한쪽 서버가 죽으면 다른 서버로 그 요청을 자동으로 넘겨주는 것을 말하죠.  
우리의 손님이 카카오톡을 안쓰는 2G폰 유저라면?  
자동으로 문자로 대신 보내주는 겁니다!  
대신 문자는 8.4원 이고, 긴문자인 mms로 보내려면 25원ㅜㅜ   
왜 카카오알림톡을 써야 하는지 알겠죠?   
fail over를 위해 별도로 짧게 줄인 안내문을 준비해서 8.4원에서 커버합시다.  


# 개발  
API방식으로 개발하면 되니까 별다른 특별한 것은 없었습니다.  
다만 500명까지 한번에 보낼 수 있으니까, 형식에 맞게 배열에 잘 담아서 보내면 되고  
타입이 json이라고 된 것은 진짜 json을 보내는 건 아니고 json형태로 string을 만들어 보내면 됩니다.   
아 한개의 전화번호는 한 요청에 한번만 전송할 수 없으니까 필요하면 별개의 요청으로 보내면 됩니다.  
(그런데 동시에 두개의 알람톡을 한번에 받는 건 없도록 해야 소비자가 혼동되지 않을꺼에요)  

개발하다보면 senderkey 라는 것이 필요한데 이것은 따로 온라인에서 받을 수는 없고  
로컬에서 개발하면서 "등록된 카카오채널 리스트" API를 호출하면  
([https://smartsms.aligo.in/shop/kakaoapispec.html#SectionFriendList](https://smartsms.aligo.in/shop/kakaoapispec.html#SectionFriendList "SectionFriendList"))  
senderkey가 응답response로 날라오니, 이를 사용하면 됩니다.  

# 템플릿
알림톡으로 스팸이나 광고는 허용하지 않고  
미리 심사받아 정해진 문구에서 #{변수}부분만 대체해서 쓸 수 있습니다.  

예를 들어 아래와 같은 문구를 등록해 놓은 후  
#{xxx}부분만 이름이라던지 주문번호 등으로 치환해서 보내는 것이죠.  

```
안녕하세요 #{user_name}님,  
신청하신 수업이 내일로 다가왔어요!  

□ 수업명 : #{class_name}  
□ 시작일 : #{start_date}  
□ 장소: 서울 용산구 이태원로54길 52 3층  
□ 준비물: 운동복, 텀블러, 땀수건  

Find, Enjoy your PEACE!  
```


문구를 심사받아서 승인받은 것만 사용 가능하고  
등록되어 있지 않은 문구는 허용하지 않습니다.  

# 알람톡 쓰자
카카오 알림톡은 아래와 같은 장점으로 인해 대기업들도 속속 도입하고 있습니다.  
1. 문자보다 저렴하고  
2. 소비자에게 친숙하고  

대기업은 아니지만 카카오 알림톡 기능을 통해 큰 기업이 될 수 있도록  
추가 개발해 봅시다!  
